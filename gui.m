%% gui: 图形用户界面
function gui
	% 窗口尺寸
	gWidth = 750;
	gHeight = 500;

	% 组件尺寸
	itemHeight = 25;
	itemHeightSmall = 20;
	itemHeightLarge = 30;
	itemWidth = 100;

	% 间隙尺寸
	gap = 20;
	gapSmall = 10;
	gapLarge = 30;

	% 特定组件的尺寸
	selectorHeight = 50;
	selectorNum = 7;
	% panel 高度
	panelHeight = gHeight - gap * 2;
	% 左侧 panel 宽度
	panelLeftWidth = 450;
	% 右侧 panel 宽度
	panelRightWidth = gWidth - panelLeftWidth - gap * 3;

	gui = figure();
	screenSize = get(0,'ScreenSize');
	set(gui, ...
		'NumberTitle','off', ...
		'Name','主界面', ...
		'MenuBar','none', ...
		'ToolBar','none', ...
		'Position',[(screenSize(3)-gWidth)/2,(screenSize(4)-gHeight)/2,gWidth,gHeight] ...
	);

	panelLeft = uipanel( ...
		'Parent',gui, ...
		'Title','选择输入文件', ...
		'Unit','pixels', ...
		'Position',[gap,gap,panelLeftWidth,panelHeight] ...
	);

	panelRight = uipanel( ...
		'Parent',gui, ...
		'Title','运行', ...
		'Unit','pixels', ...
		'Position',[panelLeftWidth+gap*2,gap,panelRightWidth,panelHeight] ...
	);

	panelSelectFolder = uipanel( ...
		'Parent',panelLeft, ...
		'Title','选择输入文件所在目录', ...
		'BorderType','none', ...
		'Unit','pixels', ...
		'Position',[gapSmall,panelHeight-gapLarge-selectorHeight,panelLeftWidth-gapSmall*2,selectorHeight] ...
	);

	editSelectFolder = uicontrol(...
		'Parent',panelSelectFolder, ...
		'Style','edit', ...
		'HorizontalAlignment', 'left', ...
		'Unit', 'normalized', ...
		'Position',[0.01,0.1,0.85,0.8] ...
	);

	btnSelectFolder = uicontrol(...
		'Parent',panelSelectFolder, ...
		'Style','pushbutton', ...
		'String','选择', ...
		'Callback',@btnSelectFolderCallback, ...
		'Unit', 'normalized', ...
		'Position',[0.87,0.1,0.12,0.8] ...
	);

	checkboxOde = uicontrol(...
		'Parent', panelRight, ...
		'Style', 'checkbox', ...
		'String', '使用 Matlab ODE 工具箱', ...
		'Unit', 'pixels', ...
		'Position', [gap,panelHeight-itemHeight-gapLarge,500,itemHeight] ...
		);

	btnRun = uicontrol(...
		'Parent',panelRight, ...
		'Style','pushbutton', ...
		'String','运行', ...
		'Callback',@btnRunCallback, ...
		'Unit', 'pixels', ...
		'Position',[gap,panelHeight-itemHeight-itemHeightLarge-gapLarge-gapSmall,itemWidth,itemHeightLarge] ...
	);


	setFontSize({panelSelectFolder,editSelectFolder,btnSelectFolder,checkboxOde},9);
	setFontSize({panelLeft,panelRight,btnRun},10);

	function setFontSize(handles, fontSize)
		for ii = 1:length(handles)
			set(handles{ii},'FontName','Microsoft YaHei','FontSize',fontSize);
		end
	end


	%% callbacks
	% 选择输入文件所在目录按钮
	function btnSelectFolderCallback(hObject, eventdata, handles)
	% hObject    handle to btnSelectFolder (see GCBO)
	% eventdata  reserved - to be defined in a future version of MATLAB
	% handles    structure with handles and user data (see GUIDATA)
		folder_name = uigetdir('./','选择输入文件所在目录');
		if folder_name == 0, return; end
		set(editSelectFolder,'String',folder_name);
	end

	% 运行按钮
	function btnRunCallback(hObject,eventdata,handles)
		fprintf('运行中……\n');

		isUseOde = get(checkboxOde,'Value');
		if isUseOde

		end
		folder_name = get(editSelectFolder,'String');
		if isempty(folder_name)
			main();
		else
			main(folder_name);
		end
	end

end
